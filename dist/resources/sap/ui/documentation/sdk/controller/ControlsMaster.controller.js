/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/Device","sap/ui/documentation/sdk/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/documentation/sdk/controller/util/ControlsInfo","sap/m/GroupHeaderListItem","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/Sorter","sap/base/util/Version","sap/ui/thirdparty/jquery","sap/base/util/UriParameters","sap/ui/util/Storage","sap/ui/core/Core","sap/ui/documentation/sdk/controller/util/Highlighter"],function(t,e,i,s,o,n,a,r,h,g,l,u,d,c,_){"use strict";var p="cozy",f="compact",S="condensed";return i.extend("sap.ui.documentation.sdk.controller.ControlsMaster",{_oStorage:new d(d.Type.local),_sStorageKey:"UI5_EXPLORED_LIST_SETTINGS_FROM_1_48",_oViewSettings:{densityMode:f,themeActive:"sap_fiori_3",rtl:false},_oDefaultSettings:{densityMode:f,themeActive:"sap_fiori_3",rtl:false},_oListSettings:{filter:{},groupProperty:"category",groupDescending:false,version:g(sap.ui.version).getMajor()+"."+g(sap.ui.version).getMinor()},_mGroupFunctions:{name:function(t){var e=t.getProperty("name").charAt(0);return{key:e,text:e}},namespace:true,category:true,since:true,formFactors:true},_sFilterValue:"",onInit:function(){this._oList=this.byId("exploredMasterList");var t,i,n,a=function(t){this._oView.getModel().setData({entityCount:t.entityCount,entities:t.entities});this.getModel("filter").setData(t.filter);this._toggleListItem(this._getItemToSelect(),true)}.bind(this);this._oRouter=this.getRouter();this._bNavToEntityViaList=false;this._oView=this.getView();o.loadData().then(a);t=new s;t.setSizeLimit(1e5);this._oView.setModel(t);i=new s({listMode:e.system.phone?"None":"SingleSelectMaster",listItemType:e.system.phone?"Active":"Inactive"});i.setDefaultBindingMode("OneWay");this._oView.setModel(i,"viewModel");n=new s;n.setSizeLimit(1e5);this.setModel(n,"filter");this._vsFilterBar=this._oView.byId("vsFilterBar");this._vsFilterLabel=this._oView.byId("vsFilterLabel");this._oRouter.getRoute("listFilter").attachPatternMatched(this._onFilterMatched,this);this._oRouter.getRoute("group").attachPatternMatched(this._onGroupMatched,this);this._oRouter.getRoute("entity").attachPatternMatched(this._onEntityMatched,this);this._oRouter.getRoute("sample").attachPatternMatched(this._onSampleMatched,this);this._oRouter.getRoute("code").attachPatternMatched(this._onSampleMatched,this);this._oRouter.getRoute("codeFile").attachPatternMatched(this._onSampleMatched,this);this._oRouter.getRoute("controls").attachPatternMatched(this._onControlsMatched,this);this._oRouter.getRoute("controlsMaster").attachPatternMatched(this._onControlsMasterMatched,this);this.LIST_SCROLL_DURATION=0;this._iDomRenderingDelay=0;this._getList().addEventDelegate({onAfterRendering:function(){setTimeout(this._scrollToSelectedListItem.bind(this),this._iDomRenderingDelay)}},this);this._oCore.attachThemeChanged(this._scrollToSelectedListItem,this);this._oCore.attachLocalizationChanged(this._onLocalizationChange,this);this._oView.addEventDelegate({onBeforeFirstShow:this.onBeforeFirstShow.bind(this)});this._oComponent=this.getOwnerComponent();this._oRootView=this.getRootView();switch(this._oComponent.getContentDensityClass()){case"sapUiSizeCompact":this._oViewSettings.densityMode=f;break;case"sapUiSizeCondensed":this._oViewSettings.densityMode=S;break;default:this._oViewSettings.densityMode=p}this._oViewSettings.rtl=this._oCore.getConfiguration().getRTL();this._oDefaultSettings.densityMode=this._oViewSettings.densityMode;this._oDefaultSettings.rtl=this._oViewSettings.rtl;this._initListSettings();this.bus=c.getEventBus();this.bus.subscribe("themeChanged","onDemoKitThemeChanged",this.onDemoKitThemeChanged,this)},onAfterRendering:function(){if(!this.highlighter){this.highlighter=new _(this._oList.getDomRef(),{shouldBeObserved:true})}},onDemoKitThemeChanged:function(t,e,i){this._oDefaultSettings.themeActive=i.sThemeActive},_viewSettingsResetOnNavigation:function(t){var e=t.getParameter("name");if(["group","entity","sample","code","code_file","controls","controlsMaster","listFilter"].indexOf(e)===-1){this._applyAppConfiguration(this._oDefaultSettings.themeActive,this._oDefaultSettings.densityMode,this._oDefaultSettings.rtl);this.getRouter().detachBeforeRouteMatched(this._viewSettingsResetOnNavigation,this)}},_initListSettings:function(){var t=this._oStorage.get(this._sStorageKey);if(t){this._oListSettings=JSON.parse(t)}},_toggleContentDensityClasses:function(t,e){switch(e){case f:t.toggleClass("sapUiSizeCompact",true).toggleClass("sapUiSizeCozy",false).toggleClass("sapUiSizeCondensed",false);break;case S:t.toggleClass("sapUiSizeCondensed",true).toggleClass("sapUiSizeCozy",false).toggleClass("sapUiSizeCompact",true);break;default:t.toggleClass("sapUiSizeCozy",true).toggleClass("sapUiSizeCondensed",false).toggleClass("sapUiSizeCompact",false)}},_applyAppConfiguration:function(t,e,i){var s,o,n,a,r,h;if(this._oViewSettings.densityMode!==e){this._toggleContentDensityClasses(l(document.body),e);this._oViewSettings.densityMode=e;h=true}if(this._oViewSettings.rtl!==i){this._oCore.getConfiguration().setRTL(i);this._oViewSettings.rtl=i;a=true}if(this._oCore.getConfiguration().getTheme()!==t){this._oCore.applyTheme(t);r=true}else if(h){this._oCore.notifyContentDensityChanged()}if(a||h||r){n=l("#sampleFrame");if(n.length>0){s=n[0].contentWindow;if(s){o=s.sap.ui.getCore();if(h){this._toggleContentDensityClasses(s.jQuery("body"),e)}if(a){o.getConfiguration().setRTL(i)}if(r){o.applyTheme(t)}else if(h){o.notifyContentDensityChanged()}}}}},_onGroupMatched:function(t){this._onMatched("#/group/",t)},_onEntityMatched:function(t){this._onMatched("#/entity/",t)},_onSampleMatched:function(t){this._onMatched("#/sample/",t)},_onMatched:function(t,e){var i=this._getList().getModel(),s=e.getParameter("arguments").entityId;this.showMasterSide();this._topicId=t+s;this._entityId=s;i.refresh();this._updateListSelection()},_onControlsMasterMatched:function(t){this.showMasterSide();if(!e.system.phone){this.getRouter().navTo("controls")}},_onFilterMatched:function(t){var i=t.getParameter("arguments").value,s;if(i){i=decodeURI(i);s=this.byId("searchField");s.setValue(i).fireLiveChange({newValue:i});setTimeout(function(){this.getSplitApp().showMaster()}.bind(this),0);if(e.system.phone){this.getRouter().navTo("controlsMaster",{})}}this._onControlsMatched(t)},_onControlsMatched:function(){this.showMasterSide();this._resetListSelection();if(e.system.desktop){setTimeout(function(){this.getView().byId("searchField").getFocusDomRef().focus()}.bind(this),0)}},_onLocalizationChange:function(t){this._iDomRenderingDelay=3e3;setTimeout(function(){this._iDomRenderingDelay=0}.bind(this),this._iDomRenderingDelay)},onNavToEntity:function(t){var e=t.getParameter("listItem"),i=e?e:t.getSource(),s=i.getBindingContext().getPath(),o=this.getView().getModel().getProperty(s);this._bNavToEntityViaList=true;this.getRouter().navTo("entity",{id:o.id,part:"samples"})},getGroupHeader:function(t){return new n({title:t.key,upperCase:false})},_updateListSelection:function(){var t=this._getItemToSelect();if(!t){return}this._toggleListItem(t,true);if(!this._bNavToEntityViaList){setTimeout(this._scrollToSelectedListItem.bind(this),0)}this._bNavToEntityViaList=false},_resetListSelection:function(){var t=this._getList().getSelectedItem();if(t){this._toggleListItem(t,false);setTimeout(this._scrollPageTo.bind(this,0,0),0)}},_toggleListItem:function(t,e){this._getList().setSelectedItem(t,e,false)},_scrollToSelectedListItem:function(){var t=this._getList().getSelectedItem();if(t){this._getPage().scrollToElement(t,this.LIST_SCROLL_DURATION)}},_scrollPageTo:function(t,e){this._getPage().scrollTo(t,e)},_getItemToSelect:function(){var t=this._getList(),e=t.getModel(),i,s,o,n=this._entityId,a=null;t.getItems().forEach(function(t){s=t.getBindingContext();if(s){o=s.getPath();i=e.getProperty(o);if(i.id===n){a=t;return false}}});return a},_getPage:function(){if(!this.oPage){this.oPage=this.byId("exploredMasterPage")}return this.oPage},_getList:function(){if(!this.oList){this.oList=this.byId("exploredMasterList")}return this.oList},onBeforeFirstShow:function(){this._updateView()},onExit:function(){this._oCore.detachThemeChanged(this._scrollToSelectedListItem,this);this._oCore.detachLocalizationChanged(this._onLocalizationChange,this);this.highlighter.destroy()},onConfirmViewSettings:function(t){var e=t.getParameter("groupItem");this._oListSettings.filter=t.getParameter("filterCompoundKeys");this._oListSettings.groupProperty=e?e.getKey():null;this._oListSettings.groupDescending=t.getParameter("groupDescending");this._oStorage.put(this._sStorageKey,JSON.stringify(this._oListSettings));this._updateView()},handleListSettings:function(){if(!this._oVSDialog){this._oVSDialog=sap.ui.xmlfragment(this.getView().getId(),"sap.ui.documentation.sdk.view.viewSettingsDialog",this);this.getView().addDependent(this._oVSDialog)}this._oVSDialog.setSelectedFilterCompoundKeys(this._oListSettings.filter);this._oVSDialog.setSelectedGroupItem(this._oListSettings.groupProperty);this._oVSDialog.setGroupDescending(this._oListSettings.groupDescending);this._oVSDialog.open()},handleListFilter:function(t){this._sFilterValue=t.getParameter("newValue").trim();if(this.highlighter){this.highlighter.highlight(this._sFilterValue)}this._updateView()},_updateListBinding:function(){var t,e,i=[],s=[],o=false,n=false,g=this._oView.byId("exploredMasterList"),u=g.getBinding("items");o=true;i.push(new a("searchTags",r.Contains,this._sFilterValue));l.each(this._oListSettings.filter,function(t,e){var s=[];l.each(e,function(e,i){var o=t==="formFactors"?r.Contains:r.EQ;s.push(new a(t,o,e))});o=true;i.push(new a(s,false))});if(o&&i.length===0){u.filter(i,"Application")}else if(o&&i.length>0){t=new a(i,true);u.filter(t,"Application")}if(this._oListSettings.groupProperty&&this._oListSettings.groupProperty!==this._sCurrentGroup){n=true}else if(this._oListSettings.groupProperty&&this._oListSettings.groupDescending!==this._bCurrentlyGroupedDescending){n=true}if(n){e=new h(this._oListSettings.groupProperty,this._oListSettings.groupDescending,this._mGroupFunctions[this._oListSettings.groupProperty]);s.push(e);s.push(new h("name",false));u.sort(s)}this._sCurrentGroup=this._oListSettings.groupProperty;this._bCurrentlyGroupedDescending=this._oListSettings.groupDescending;this._bIsViewUpdatedAtLeastOnce=true},_updateView:function(){this._updateFilterBarDisplay();this._updateListBinding()},_updateFilterBarDisplay:function(){var t=[];l.each(this._oListSettings.filter,function(e,i){t=t.concat(Object.keys(i))});if(t.length>0){this._vsFilterBar.setVisible(true);this._vsFilterLabel.setText(t.join(", "))}else{this._vsFilterBar.setVisible(false)}},handleSettings:function(){if(!this._oSettingsDialog){this._oSettingsDialog=new sap.ui.xmlfragment("sap.ui.documentation.sdk.view.appSettingsDialog",this);this._oView.addDependent(this._oSettingsDialog)}setTimeout(function(){var t=this._oCore.getConfiguration(),e=this._oCore.byId("ThemeSelect"),i=u.fromQuery(window.location.search).get("sap-theme"),s=this._oViewSettings.densityMode;e.setSelectedKey(i?i:t.getTheme());this._oCore.byId("RTLSwitch").setState(t.getRTL());this._oCore.byId("DensityModeSwitch").setSelectedKey(s);this._oSettingsDialog.open()}.bind(this),0)},handleCloseAppSettings:function(){this._oSettingsDialog.close()},handleSaveAppSettings:function(){var e,i=this._oCore.byId("DensityModeSwitch").getSelectedKey(),s=this._oCore.byId("ThemeSelect").getSelectedKey(),o=this._oCore.byId("RTLSwitch").getState();this._oSettingsDialog.close();if(!this._oBusyDialog){t.sap.require("sap.m.BusyDialog");e=sap.ui.require("sap/m/BusyDialog");this._oBusyDialog=new e;this.getView().addDependent(this._oBusyDialog)}this._oBusyDialog.open();setTimeout(function(){this._oBusyDialog.close()}.bind(this),1e3);this._applyAppConfiguration(s,i,o);this.getRouter().attachBeforeRouteMatched(this._viewSettingsResetOnNavigation,this)}})});