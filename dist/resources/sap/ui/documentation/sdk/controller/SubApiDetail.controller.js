/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/documentation/sdk/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/documentation/sdk/controller/util/ControlsInfo","sap/ui/documentation/sdk/util/ToggleFullScreenHandler","sap/ui/documentation/sdk/controller/util/APIInfo","sap/ui/documentation/sdk/model/formatter","sap/m/Image","sap/m/Label","sap/m/Link","sap/m/Text","sap/m/HBox","sap/m/ObjectAttribute","sap/m/ObjectStatus","sap/m/Popover","sap/m/library","sap/ui/core/library","sap/m/CustomListItem","sap/m/List"],function(t,e,i,o,s,n,r,a,l,c,h,u,d,p,g,_,f,m,y){"use strict";var b=_.FlexWrap;var P=f.ValueState;return e.extend("sap.ui.documentation.sdk.controller.SubApiDetail",{NOT_AVAILABLE:"N/A",PUBLIC_GITHUB_FRAMEWORK_DOMAIN:"https://github.com/SAP/openui5/blob/master/src/",SECTION_MAP:{properties:"controlProperties",fields:"properties","special settings":"specialsettings"},formatter:r,onInit:function(){this._objectPage=this.byId("apiDetailObjectPage");if(!window.hljs){t.sap.includeStyleSheet("resources/sap/ui/documentation/sdk/thirdparty/highlight.js/styles.css");t.sap.includeScript({url:"resources/sap/ui/documentation/sdk/thirdparty/highlight.js/highlight.js"})}},initiate:function(e){var i,o,s,n=function(t){return!t.borrowedFrom};this._sTopicId=e.sTopicId;this._oModel=e.oModel;this._oControlData=this._oModel.getData();this._aApiIndex=e.aApiIndex;this._aAllowedMembers=e.aAllowedMembers;this._sEntityType=e.sEntityType;this._sEntityId=e.sEntityId!=="undefined"?e.sEntityId:undefined;this._oEntityData=e.oEntityData;this._oContainerController=e.oContainerController;this._oContainerView=e.oContainerView;this._oToggleFullScreenBtn=this.byId("toggleFullScreenBtn");this.getOwnerComponent=function(){return e.oOwnerComponent};this._oRouter=this.getRouter();this._allProperties=this._oModel.getProperty("/ui5-metadata/properties");this._allAggregations=this._oModel.getProperty("/ui5-metadata/aggregations");this._allAssociations=this._oModel.getProperty("/ui5-metadata/associations");if(this._allProperties){this._selfProperties=this._allProperties.filter(n);i=this._selfProperties.length>0;this._oModel.setProperty("/bShowBorrowedProps",!i);this._oModel.setProperty("/bHasSelfProps",i);this._oModel.setProperty("/bHasBorrowedProps",this._allProperties.length>this._selfProperties.length);this._oModel.setProperty("/ui5-metadata/properties",i?this._selfProperties:this._allProperties)}if(this._allAggregations){this._selfAggregations=this._allAggregations.filter(n);o=this._selfAggregations.length>0;this._oModel.setProperty("/bShowBorrowedAggr",!o);this._oModel.setProperty("/bHasSelfAggr",o);this._oModel.setProperty("/bHasBorrowedAggr",this._allAggregations.length>this._selfAggregations.length);this._oModel.setProperty("/ui5-metadata/aggregations",o?this._selfAggregations:this._allAggregations)}if(this._allAssociations){this._selfAssociations=this._allAssociations.filter(n);s=this._selfAssociations.length>0;this._oModel.setProperty("/bShowBorrowedAssoc",!s);this._oModel.setProperty("/bHasSelfAssoc",s);this._oModel.setProperty("/bHasBorrowedAssoc",this._allAssociations.length>this._selfAssociations.length);this._oModel.setProperty("/ui5-metadata/associations",s?this._selfAssociations:this._allAssociations)}if(this._oModel.getProperty("/hasFAQ")){var r=this._oEntityData.lib,a=r.replace(/\./g,"/"),l=this._oEntityData.name.replace(r,"").replace(/^[.]/,"").replace(/\./g,"/")+".html";t.ajax({type:"GET",url:"./docs/api/"+a+"/demokit/faq/"+l,success:function(t){this._oModel.setProperty("/faqContent",t)}.bind(this)})}this.setModel(this._oModel);this._oEntityData.appComponent=this._oControlData.component||this.NOT_AVAILABLE;this._oEntityData.hasSample=this._oControlData.hasSample;this._oEntityData.sample=this._oControlData.hasSample?this._sTopicId:this.NOT_AVAILABLE;this._buildHeaderLayout(this._oControlData,this._oEntityData);setTimeout(function(){this._hljs();this._objectPage.attachEvent("subSectionEnteredViewPort",function(){if(this._sHljsDelayedCallID){clearTimeout(this._sHljsDelayedCallID)}this._sHljsDelayedCallID=setTimeout(function(){var t=this._objectPage.$().find("pre:not(.hljs)");if(t.length>0&&window.hljs){t.addClass("hljs");document.querySelectorAll("pre").forEach(function(t){window.hljs.highlightBlock(t)})}}.bind(this),200)},this);setTimeout(function(){if(this._sEntityType){this.scrollToEntity(this._sEntityType,this._sEntityId)}setTimeout(function(){this._objectPage.attachEvent("_sectionChange",function(t){var e=t.getParameter("section"),i=t.getParameter("subSection");if(this._oNavigatingTo){if(this._oNavigatingTo===i){this._oNavigatingTo=null}return}this._modifyURL(e,i,false)},this);this._objectPage.attachEvent("navigate",function(t){var e=t.getParameter("section"),i=t.getParameter("subSection");this._oNavigatingTo=i;this._modifyURL(e,i,true)},this)}.bind(this),500)}.bind(this),1e3)}.bind(this),0);this.searchResultsButtonVisibilitySwitch(this.byId("apiDetailBackToSearch"));this.appendPageTitle(this._oModel.getProperty("/displayName"))},onAfterRendering:function(){this.getView().attachBrowserEvent("click",this.onJSDocLinkClick,this);s.updateControl(this._oToggleFullScreenBtn,this._oContainerView,this._oContainerController)},onExit:function(){this.getView().detachBrowserEvent("click",this.onJSDocLinkClick,this)},onToggleFullScreen:function(t){s.updateMode(t,this._oContainerView,this._oContainerController)},onBorrowedPropCheckboxClick:function(t){var e=t.getParameter("selected");this._oModel.setProperty("/bShowBorrowedProps",e);this._oModel.setProperty("/ui5-metadata/properties",e?this._allProperties:this._selfProperties)},onBorrowedAggrCheckboxClick:function(t){var e=t.getParameter("selected");this._oModel.setProperty("/bShowBorrowedAggr",e);this._oModel.setProperty("/ui5-metadata/aggregations",e?this._allAggregations:this._selfAggregations)},onBorrowedAssocCheckboxClick:function(t){var e=t.getParameter("selected");this._oModel.setProperty("/bShowBorrowedAssoc",e);this._oModel.setProperty("/ui5-metadata/associations",e?this._allAssociations:this._selfAssociations)},onJSDocLinkClick:function(t){var e=t.target.classList,i=e.contains("sapUISDKExternalLink");if(i){this.onDisclaimerLinkPress(t);return}},_modifyURL:function(t,e,i){var o=t.getTitle().toLowerCase(),s=e&&e.getTitle()!=="Overview"?e.getTitle():"";if(Object.keys(this.SECTION_MAP).indexOf(o)>=0){o=this.SECTION_MAP[o]}this._oRouter.navToChangeUrlOnly({id:this._sTopicId,entityType:o,entityId:s},i)},_hljs:function(){if(window.hljs){document.querySelectorAll("pre").forEach(function(t){window.hljs.highlightBlock(t)})}},scrollToEntity:function(t,e){var i,o,s;if(!t){return}t=t.toLowerCase();s=this.byId(t);if(!s){return}if(e){e=e.toLowerCase();o=s.getSubSections();i=o.filter(function(t){return t.getTitle().toLowerCase()===e});if(i.length){this._objectPage.scrollToSection(i[0].getId(),250)}}else{this._objectPage.scrollToSection(s.getId(),250)}},_scrollContentToTop:function(){if(this._objectPage&&this._objectPage.$().length>0){this._objectPage.getScrollDelegate().scrollTo(0,0)}},_getHeaderLayoutUtil:function(){if(!this._oHeaderLayoutUtil){var t=function(t,e,i){var o=new d({title:t,text:e}).addStyleClass("sapUiTinyMarginBottom");if(i){o.setCustomContent(i)}return o},e=function(t,e){return new p({title:"Visibility",text:r.formatVisibility(t,e),state:P.Warning}).addStyleClass("sapUiTinyMarginBottom")},i=function(t){return new c(t||{})},o=function(t){return new h(t||{})},s=function(t){return new l(t||{})},n=function(t,e){var i=new u(t||{});if(e){i.addStyleClass("sapUiDocumentationHeaderNavLinks sapUiTinyMarginBottom")}return i};this._oHeaderLayoutUtil={_getControlSampleBlock:function(t,e){return n({items:[s({design:"Bold",text:"Control Sample:"}),i({emphasized:true,text:e.sample,visible:!!e.hasSample,href:"entity/"+t.name}),o({text:e.sample,visible:!e.hasSample})]},true)},_getControlGithub:function(t,e){return n({items:[s({design:"Bold",text:"GitHub:"}),i({emphasized:true,text:t.resource,visible:true,href:this.PUBLIC_GITHUB_FRAMEWORK_DOMAIN+e.lib+"/src/"+t.resource})]},true)},_getDocumentationBlock:function(t,e){return n({items:[s({design:"Bold",text:"Documentation:"}),i({emphasized:true,text:t.docuLinkText,href:"topic/"+t.docuLink})]},true)},_getUXGuidelinesBlock:function(t){return n({items:[s({design:"Bold",text:"UX Guidelines:"}),i({emphasized:true,text:t.uxGuidelinesLinkText,href:t.uxGuidelinesLink,target:"_blank"}),new a({src:"./resources/sap/ui/documentation/sdk/images/link-sap.png",tooltip:"Information published on SAP site",press:this.onDisclaimerLinkPress})]},true)},_getExtendsBlock:function(t,e){return n({items:[s({text:"Extends:"}),i({text:t.extendsText,href:"api/"+t.extendsText,visible:t.isDerived}),o({text:t.extendsText,visible:!t.isDerived})]},true)},_getSubclassesBlock:function(t,e){var o=e.extendedBy||e.implementedBy,r;this._aSubClasses=o;if(o.length===1){r=i({text:o[0],href:"api/"+o[0]})}else{r=i({text:t.isClass?"View subclasses":"View implementations",press:this._openSubclassesImplementationsPopover.bind(this)})}return n({items:[s({text:t.isClass?"Known direct subclasses:":"Known direct implementations:"}),r]},true)},_getImplementsBlock:function(t,e){var o=[s({text:"Implements:"})];t.implementsParsed.forEach(function(t){o.push(i({text:t.name,href:"api/"+t.href}))});return n({items:o,wrap:b.Wrap},true).addStyleClass("sapUiDocumentationCommaList")},_getModuleBlock:function(e,i){return t("Module",e.module)},_getLibraryBlock:function(e,i){return t("Library",i.lib)},_getVisibilityBlock:function(o,s){var n=o.visibility,r=s.allowedFor;if(n==="restricted"&&r){return r.length>1?t("Visibility",n,i({text:"restricted to",press:this._openVisibilityPopover.bind(this,r)})):e(n,r)}else{return t("Visibility",n)}},_getAvailableSinceBlock:function(e,i){return t("Available since",e.sinceText)},_getApplicationComponentBlock:function(e,i){return t("Application Component",i.appComponent)}}}return this._oHeaderLayoutUtil},_openSubclassesImplementationsPopover:function(t){var e=this._aSubClasses.map(function(t){return new m({content:[new c({text:t,href:"api/"+t}).addStyleClass("sapUiTinyMargin")]})}),i=this._addPopoverContent(e);i.openBy(t.getSource())},_openVisibilityPopover:function(t,e){var i=t.map(function(t){return new m({content:[new h({text:t}).addStyleClass("sapUiTinyMargin")]})}),o=this._addPopoverContent(i);o.openBy(e.getSource())},_addPopoverContent:function(t){var e=this._getPopover();if(e.getContent().length>0){e.destroyContent()}if(t&&t.length>0){var i=new y({items:t||[]});e.addContent(i)}return e},_getPopover:function(){if(!this._oPopover){this._oPopover=new g({placement:"Bottom",showHeader:false})}return this._oPopover},_buildHeaderLayout:function(t,e){var i=0,o=1,s=2,n=3,r=[[],[],[]],a=this._getHeaderLayoutUtil(),l=e.extendedBy||e.implementedBy||[],c=this.getModel("versionData").getProperty("/isOpenUI5"),h=[{creator:"_getControlSampleBlock",exists:t.isClass||t.isNamespace},{creator:"_getDocumentationBlock",exists:t.docuLink!==undefined},{creator:"_getControlGithub",exists:c&&t.resource&&e.lib},{creator:"_getUXGuidelinesBlock",exists:t.uxGuidelinesLink!==undefined},{creator:"_getExtendsBlock",exists:t.isClass},{creator:"_getSubclassesBlock",exists:l.length>0},{creator:"_getImplementsBlock",exists:t.hasImplementsData},{creator:"_getModuleBlock",exists:true},{creator:"_getLibraryBlock",exists:t.kind==="namespace"&&e.lib},{creator:"_getVisibilityBlock",exists:t.visibility},{creator:"_getAvailableSinceBlock",exists:true},{creator:"_getApplicationComponentBlock",exists:true}],u=function(){var l=0,c,u=function(t){if(t<=n){return i}else if(t<=n*2){return o}return s};h.forEach(function(i){var o;if(i.exists){o=a[i.creator].call(this,t,e);c=u(++l);r[c].push(o)}},this)}.bind(this);u();r.forEach(function(t,e){var i=this.byId("headerColumn"+e);i.removeAllContent();if(t.length>0){i.setVisible(true);t.forEach(i.addContent,i)}},this)},onAnnotationsLinkPress:function(){this.scrollToEntity("annotations","Summary")},backToSearch:function(){this.onNavBack()}})});