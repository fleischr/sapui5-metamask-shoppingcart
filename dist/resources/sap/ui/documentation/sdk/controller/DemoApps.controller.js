/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/documentation/sdk/controller/BaseController","sap/ui/model/resource/ResourceModel","sap/ui/Device","sap/ui/model/json/JSONModel","sap/ui/documentation/sdk/controller/util/ResourceDownloadUtil","sap/ui/documentation/sdk/model/formatter","sap/m/MessageBox","sap/m/MessageToast","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/documentation/sdk/model/libraryData","sap/base/Log"],function(e,t,n,i,o,a,s,r,d,l,u,h,c){"use strict";return t.extend("sap.ui.documentation.sdk.controller.DemoApps",{formatter:s,onInit:function(){var e=new o,t=new n({bundleName:"sap.ui.documentation.messagebundle"});h.fillJSONModel(e);this.setModel(e);this.getView().setModel(t,"i18n");this.setModel(new o({demoAppsHomeLink:"topic/a3ab54ecf7ac493b91904beb2095d208"}),"newWindowLinks");this.getRouter().getRoute("demoapps").attachPatternMatched(this._onMatched,this);sap.ui.getVersionInfo({async:true}).then(function(e){var t=new o({isOpenUI5:e&&e.gav&&/openui5/i.test(e.gav)});this.getView().setModel(t,"appView")}.bind(this));this._onOrientationChange({landscape:i.orientation.landscape});this._onResize({name:i.resize.width<=600?"Phone":"NoPhone"})},onBeforeRendering:function(){this._deregisterOrientationChange()},onAfterRendering:function(){this._registerOrientationChange();this._registerResize()},onExit:function(){this._deregisterOrientationChange();this._deregisterResize()},_registerOrientationChange:function(){i.orientation.attachHandler(this._onOrientationChange,this)},_deregisterOrientationChange:function(){i.orientation.detachHandler(this._onOrientationChange,this)},_registerResize:function(){i.media.attachHandler(this._onResize,this)},_deregisterResize:function(){i.media.detachHandler(this._onResize,this)},_onOrientationChange:function(e){this.byId("phoneImage").toggleStyleClass("phoneHeaderImageLandscape",e.landscape)},_onResize:function(e){this.byId("phoneImage").setVisible(e.name==="Phone");this.byId("desktopImage").setVisible(e.name!=="Phone");this.byId("phoneImage").toggleStyleClass("phoneHeaderImageDesktop",e.name==="Phone")},_onMatched:function(){try{this.hideMasterSide()}catch(e){c.error(e)}},onDownloadButtonPress:function(e){var t=this.byId("downloadDialog"),n=this.byId("downloadDialogList");this._oDownloadButton=e.getSource();n.getBinding("items").filter([]);t.open()},onReadMoreButtonPress:function(){var e=s.formatHttpHrefForNewWindow(this.getModel("newWindowLinks").getProperty("/demoAppsHomeLink"));window.open(e,"_blank")},onSearch:function(e){var t=this.byId("downloadDialogList"),n=e.getParameter("newValue");t.getBinding("items").filter([new l("name",u.Contains,n)])},onCloseDialog:function(){var e=this.byId("downloadDialog"),t=this.byId("downloadDialogSearch");e.close();t.setValue("")},onDownloadPress:function(t){var n=t.getParameters().selectedItem,i=n?n:t.getSource().getParent();this._oDownloadButton.setBusy(true);sap.ui.require(["sap/ui/core/util/File","sap/ui/thirdparty/jszip"],function(t,n){var o=new n;e.getJSON(i.data("config"),function(e){var n=e.files,s=[],r=[];n.forEach(function(t){var n=a.fetch(e.cwd+t);n.then(function(e){if(e.errorMessage){r.push(e.errorMessage)}else{if(!t.startsWith("../")){o.file(t,e,{base64:false,binary:true})}}});s.push(n)});
// add generic license file
var l=sap.ui.require.toUrl("LICENSE.txt").replace("resources/","");var u=a.fetch(l);var h=new Promise(function(e,t){u.then(function(t){o.file("LICENSE.txt",t);e()}).catch(function(){
// LICENSE.txt not available in SAPUI5, continue without it
e()})});s.push(h);Promise.all(s).then(function(){if(r.length){var e=r.reduce(function(e,t){return e+t+"\n"},"Could not locate the following download files:\n");this._handleError(e)}this._oDownloadButton.setBusy(false);d.show('Downloading for app "'+i.getLabel()+'" has been started');var n=o.generate({type:"blob"});this._createArchive(t,n,i.getLabel())}.bind(this))}.bind(this))}.bind(this))},createDemoAppCell:function(e,t){var n;if(t.getObject().teaser){try{sap.ui.loader.config({paths:{"test-resources":"test-resources"}});var i=sap.ui.require.toUrl(t.getObject().teaser);var o=sap.ui.xmlfragment(e,i);n=sap.ui.xmlfragment(e,"sap.ui.documentation.sdk.view.BlockLayoutTeaserCell",this);n.getContent()[0].addContent(o);sap.ui.loader.config({paths:{"test-resources":null}});o.addEventDelegate({onAfterRendering:function(){this.getParent().getDomRef().childNodes[1].setAttribute("aria-hidden","true")}.bind(o)})}catch(i){c.warning('Teaser for demo app "'+t.getObject().name+'" could not be loaded: '+i);n=sap.ui.xmlfragment(e,"sap.ui.documentation.sdk.view.BlockLayoutCell",this)}}else{n=sap.ui.xmlfragment(e,"sap.ui.documentation.sdk.view.BlockLayoutCell",this)}n.setBindingContext(t);return n},_createArchive:function(e,t,n){e.save(t,n,"zip","application/zip")},_handleError:function(e){r.error(e)},handleLandingImageLoad:function(){this.byId("landingImageHeadline").setVisible(true)}})});