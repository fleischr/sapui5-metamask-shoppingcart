/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/documentation/sdk/controller/BaseController","sap/m/library","sap/ui/model/json/JSONModel","sap/ui/thirdparty/URI","sap/uxap/ThrottledTaskHelper"],function(e,t,i,o,r){"use strict";var s={HTML:"index.html",XML:"App.view.xml",INDEX_JS:"index.js",CONTROLLER_JS:"App.controller.js"},n="HelloWorld",l=function(e){return n+"/"+e},a={};a[s.HTML]="text";a[s.XML]="xml";a[s.INDEX_JS]="javascript";a[s.CONTROLLER_JS]="javascript";return e.extend("sap.ui.documentation.sdk.controller.LiveEditor",{onInit:function(){this._oSrcFileContent={};this._oViewModel=new i({autoPreview:true,selectedFileName:s.XML,selectedFileType:a[s.XML],selectedFileContent:""});this.getView().setModel(this._oViewModel,"viewModel");new i(sap.ui.require.toUrl("sap/ui/documentation/sdk/model/LiveEditorData.json")).attachRequestCompleted(function(e){var t=e.getSource().getData(),i=new o(sap.ui.require.toUrl("sap-ui-core.js"),document.baseURI).href();if(t[s.HTML]){t[s.HTML]=t[s.HTML].replace(/&sol;/g,"/").replace("resources/sap-ui-core.js",i)}this._oSrcFileContent=t;this.showFileInEditor(s.XML)}.bind(this));this.getView().byId("resultBox").addEventDelegate({onAfterRendering:this.requestExecuteCurrentSrc.bind(this)});this._bSuppressRemoveOnce=false;this._bSuppressInsertOnce=false;this._oThrottledTask=null},onSrcLiveChange:function(e){var t=e.getParameter("value"),i=e.getParameter("editorEvent").action,o;if(this._bSuppressRemoveOnce===true&&i==="remove"){this._bSuppressRemoveOnce=false;return}if(this._bSuppressInsertOnce===true&&i==="insert"){this._bSuppressInsertOnce=false;return}o=this._oViewModel.getProperty("/selectedFileName");this._oSrcFileContent[o]=t;if(this._oViewModel.getProperty("/autoPreview")){this.requestExecuteCurrentSrc()}},requestExecuteCurrentSrc:function(){this._getExecuteSrcThrottledTask().reSchedule(false,{}).catch(function(e){})},createFrame:function(){var e=document.createElement("iframe");e.id="outputWindow";e.width="100%";e.className="editorOutputWindow";e.src=sap.ui.require.toUrl("sap/ui/documentation/sdk/util/liveEditorOutput.html");e.sandbox="allow-forms allow-modals allow-pointer-lock allow-popups allow-scripts";return e},onFileSwitch:function(e){var t=e.getParameter("selectedKey");this._bSuppressRemoveOnce=true;this._bSuppressInsertOnce=true;this.showFileInEditor(t)},showFileInEditor:function(e){this._oViewModel.setProperty("/selectedFileContent",this._oSrcFileContent[e]);this._oViewModel.setProperty("/selectedFileType",a[e])},_getDataToPost:function(){var e={},t=l(s.INDEX_JS).slice(0,-3),i,o;Object.keys(s).forEach(function(t){o=s[t];i=l(o);e[i]=this._oSrcFileContent[o]},this);return{src:e,moduleNameToRequire:t}},_getExecuteSrcThrottledTask:function(){var e;if(!this._oThrottledTask){e=function(){var e=this.getView().byId("outputWindowWrapper").getDomRef(),t;if(e){while(e.firstChild){e.removeChild(e.firstChild)}t=this.createFrame();t.onload=function(){if(t.contentWindow){t.contentWindow.postMessage(this._getDataToPost(),"*");t.onload=null}}.bind(this);e.appendChild(t)}};this._oThrottledTask=new r(e,500,this)}return this._oThrottledTask},onNavButtonPress:function(){this.getRouter().myNavBack("welcome")}})});