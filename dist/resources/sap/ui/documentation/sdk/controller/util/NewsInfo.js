/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Core","sap/ui/thirdparty/jquery","sap/ui/documentation/sdk/util/Resources","sap/base/Log"],function(e,t,n,r){"use strict";var i={},s=[],o=[],a=null,u=false,c="OLD_NEWS_IDS",f,l;function d(e){if(i["newsRSS"]){return Promise.resolve(i["newsRSS"])}l=e;f=l.LOCAL_STORAGE_NAMES[c];return O().then(R).then(v).then(p).catch(function(e){a=e.message;r.error(a)}).finally(y)}function p(){if(u){return Promise.resolve()}var e=l.getLocalStorageItem(f);return new Promise(function(t){var n=i["newsRSS"].items,r;if(Array.isArray(e)){for(var a=0;a<n.length;a++){r=n[a];if(e.indexOf(r.id)!==-1){o.push(r)}else{s.push(r)}}}else{s=n.slice()}u=true;t()})}function g(){return a}function h(){return s}function S(){return o}function m(e){var t=s.indexOf(e),n=l.getLocalStorageItem(f)||[];if(t>-1){s.splice(t,1)}o.push(e);n.push(e.id);l.setLocalStorageItem(f,n);y()}function w(){var e=l.getLocalStorageItem(f)||[],t;for(var n=0;n<s.length;n++){t=s[n];o.push(t);e.push(t.id)}s=[];l.setLocalStorageItem(f,e);y()}function v(){var e=i["newsRSS"].items;e.forEach(function(e){e.updated=new Date(e.updated).toLocaleString()})}function y(){e.getEventBus().publish("newsChanged","onDemoKitNewsChanged")}function O(){return new Promise(function(e){t.ajax(n.getResourceOriginPath("/news-config.json"),{type:"GET",dataType:"JSON",success:function(t){e(t)},error:function(){r.error("failed to load news-config.json");e()}})})}function R(e){return new Promise(function(s){t.ajax(n.getResourceOriginPath(e.feedPath),{type:"GET",dataType:"xml",success:function(e){var n=[];t("item",e).each(function(){var e={};e.title=t(this).find("title").eq(0).text();e.link=t(this).find("link").eq(0).text();e.description=t(this).find("description").eq(0).text();e.updated=t(this).find("pubDate").eq(0).text();e.id=t(this).find("guid").eq(0).text();n.push(e)});i["newsRSS"]={items:n};s(i["newsRSS"])},error:function(){r.error("failed to load news rss");i["newsRSS"]=null;s()}})})}return{moveAllNewItemsToOld:w,moveNewItemToOld:m,prepareNewsData:d,getPreparationFailureMessage:g,getNewNewsArray:h,getOldNewsArray:S}});