/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/documentation/sdk/controller/BaseController","sap/ui/documentation/sdk/controller/util/SearchUtil","sap/ui/documentation/sdk/controller/util/Highlighter","sap/ui/model/json/JSONModel","sap/m/GroupHeaderListItem","sap/base/Log"],function(e,t,r,i,a,s,o){"use strict";return t.extend("sap.ui.documentation.sdk.controller.SearchPage",{onInit:function(){this.setModel(new a,"searchView");this.getRouter().getRoute("search").attachPatternMatched(this._onTopicMatched,this)},onAfterRendering:function(){var e={useExternalStyles:false,shouldBeObserved:true,isCaseSensitive:false};if(!this.highlighter){this.highlighter=new i(this.getView().getDomRef(),e)}},onExit:function(){this.highlighter.destroy()},_onTopicMatched:function(e){var t=decodeURIComponent(e.getParameter("arguments").searchParam),i=e.getParameter("arguments")["?options"],a=i&&i.category,s=this.byId("allList"),n=this._findSectionForCategory(a),c=n?n.getId():null,h=this.getModel("searchView").getProperty("/lastProcessedQuery"),g="";try{this.hideMasterSide()}catch(e){o.error(e)}if(t===h){this.getView().byId("searchPage").setSelectedSection(c);return}this.getModel("searchData").setProperty("/query",t);s.setBusy(true);r.search(t,{includeDeprecated:this.getModel("searchData").getProperty("/includeDeprecated")}).then(function(e){this.getModel("searchView").setProperty("/lastProcessedQuery",t);this.getModel("searchData").setProperty("/matches",e.matches);this.getView().byId("searchPage").setSelectedSection(c);s.setBusy(false)}.bind(this));if(this.highlighter){this.highlighter.highlight(t)}g=this.getModel("i18n").getResourceBundle().getText("SEARCH_PAGE_TITLE",[t]);this.appendPageTitle(g)},formatTableTitle:function(e,t,r){var i=r>0?"1 - "+t:"0";return this.formatMessage(e,i,r)},onDeprecatedFlagChange:function(e){var t=e.getParameter("selected"),i=this.getModel("searchData").getProperty("/query");r.search(i,{includeDeprecated:t}).then(function(e){this.getModel("searchData").setProperty("/matches",e.matches)}.bind(this))},_findSectionForCategory:function(e){var t=this.getView().byId("searchPage").getSections().filter(function(t){return t.data("category")==e});return t.length&&t[0]},_modifyLinks:function(){var e=this.getView(),t=[].concat(e.byId("allList").getItems(),e.byId("apiList").getItems(),e.byId("documentationList").getItems(),e.byId("samplesList").getItems()),r=t.length,i;while(r--){i=t[r];if(i._getLinkSender){i._getLinkSender().setHref(i.getCustomData()[0].getValue())}}},getGroupHeader:function(e){return new s({title:e.key,upperCase:false})},categoryAPIFormatter:function(e){return e==="API Reference"},categoryDocFormatter:function(e){return e==="Documentation"},categoryExploredFormatter:function(e){return e==="Samples"},onAllLoadMore:function(e){this.getModel("searchView").setProperty("/visibleAllLength",e.getParameter("actual"));this._modifyLinks()},onAPILoadMore:function(e){this.getModel("searchView").setProperty("/visibleAPILength",e.getParameter("actual"));this._modifyLinks()},onDocLoadMore:function(e){this.getModel("searchView").setProperty("/visibleDocLength",e.getParameter("actual"));this._modifyLinks()},onExploredLoadMore:function(e){this.getModel("searchView").setProperty("/visibleExploredLength",e.getParameter("actual"));this._modifyLinks()},onSwitchTab:function(e){var t=e.getParameter("section").data("category"),r={searchParam:this.getModel("searchView").getProperty("/lastProcessedQuery")};if(t){r["?options"]={category:t}}this.getRouter().navTo("search",r)}})});